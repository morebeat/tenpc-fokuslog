<VirtualHost *:80>
    ServerName localhost
    ServerAlias *.local
    
    DocumentRoot /var/www/html/app
    
    # Enable rewrite engine
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase /
        
        # Redirect HTTP to HTTPS if needed
        # RewriteCond %{HTTPS} off
        # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    </IfModule>
    
    # Main application directory
    <Directory /var/www/html/app>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Rewrite rules for single-page app
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^(.*)$ index.html [QSA,L]
        </IfModule>
    </Directory>
    
    # API directory - rewrite to index.php
    <Directory /var/www/html/api>
        Options FollowSymLinks
        AllowOverride All
        Require all granted
        
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /api/
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^(.*)$ index.php [L,QSA]
        </IfModule>
    </Directory>
    
    # Assets - Cache control
    <Directory /var/www/html/app/assets>
        <IfModule mod_expires.c>
            ExpiresActive On
            ExpiresByType image/jpeg "access plus 30 days"
            ExpiresByType image/gif "access plus 30 days"
            ExpiresByType image/png "access plus 30 days"
            ExpiresByType text/css "access plus 7 days"
            ExpiresByType application/javascript "access plus 7 days"
        </IfModule>
    </Directory>
    
    # Security headers
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-XSS-Protection "1; mode=block"
        Header set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>
    
    # Logging
    ErrorLog /var/www/html/logs/apache_error.log
    CustomLog /var/www/html/logs/apache_access.log combined
    
    # PHP Settings
    <IfModule mod_php.c>
        php_value upload_max_filesize 100M
        php_value post_max_size 100M
        php_value memory_limit 256M
        php_value max_execution_time 300
        php_value default_charset "UTF-8"
    </IfModule>
</VirtualHost>

# HTTPS Configuration (uncomment if using SSL)
# <VirtualHost *:443>
#     ServerName localhost
#     DocumentRoot /var/www/html/app
#     
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
#     SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
#     
#     # Rest of configuration same as above
# </VirtualHost>
